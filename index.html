<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello React!</title>
    <style>
      .done{
        text-decoration: line-through;
      }
    </style>
  </head>
  <body>
    <!-- DOM element to insert React components -->
    <div id="app"></div>

    <!-- React libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.1.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.1.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.10.3/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/lodash/4.13.1/lodash.min.js"></script>

    <!-- Main code -->
    <script type="text/babel">

      class TodoItem extends React.Component {
        render () {
          return (
            <li className={this.props.completed ? 'done': ''}
                onClick={() => this.props.onTodoClicked(this.props.todo)}>
            {this.props.todo}</li>
          )
        }
      }

      class TodoList extends React.Component {
        render() {
          let todos = _.map(this.props.todos, (todo) => {
            return (
              <TodoItem todo={todo.todo}
              key={todo.todo} completed={todo.completed}
              onTodoClicked={this.props.onTodoClicked} />
            );
          })
          return <ul>{todos}</ul>
        }
      }

      class TodoApp extends React.Component {
        constructor(){
          super();
          this.state = {
            todoText: '',
            todos: []
          }
        }
        handleInputChange(evt){
          this.setState({todoText: evt.target.value})
        }
        handleAddTodo(){
          if(this.state.todoText){
            const todo = this.state.todoText;
            this.setState({
              todos: [...this.state.todos, {
                todo: todo,
                completed: false
              }],
              todoText: ''
            });
          }
        }
        onTodoClicked(todo){
          let todos = _.map(this.state.todos, (elem) => {
            if(elem.todo == todo){
              return {
                todo: todo,
                completed: !elem.completed
              }
            }
            return elem
          });
          this.setState({todos})
        }
        render() {
          return <div>
            <input type="text" value={this.state.todoText} onChange={this.handleInputChange.bind(this)}/>
            <button onClick={this.handleAddTodo.bind(this)}>Add Todo</button>
            <TodoList todos={this.state.todos} onTodoClicked={this.onTodoClicked.bind(this)}/>
            <p>Input text: {this.state.todoText}</p>
          </div>
        }
      }
      ReactDOM.render(
        <TodoApp />,
        document.getElementById('app'));
    </script>
  </body>
</html>
